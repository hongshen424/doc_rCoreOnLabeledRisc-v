
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>3.启动流程分析 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="4.硬件分析.html" />
    
    
    <link rel="prev" href="2.火苗平台简介.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="1.安装环境.html">
            
                <a href="1.安装环境.html">
            
                    
                    1.安装环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="2.火苗平台简介.html">
            
                <a href="2.火苗平台简介.html">
            
                    
                    2.火苗平台简介
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="3.启动流程分析.html">
            
                <a href="3.启动流程分析.html">
            
                    
                    3.启动流程分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="4.硬件分析.html">
            
                <a href="4.硬件分析.html">
            
                    
                    4.硬件分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="5.分页机制分析.html">
            
                <a href="5.分页机制分析.html">
            
                    
                    5.分页机制分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="6.启动多个rcore.html">
            
                <a href="6.启动多个rcore.html">
            
                    
                    6.启动多个rcore
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >3.启动流程分析</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x5206;&#x6790;">&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x5206;&#x6790;</h2>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#xFF0C;&#x5185;&#x6838;&#x662F;&#x4E00;&#x6B65;&#x6B65;&#x600E;&#x4E48;&#x751F;&#x6210;&#x5230;&#x6700;&#x540E;&#x7684;linux.bin&#xFF0C;&#x5E76;&#x6700;&#x7EC8;&#x5728;&#x706B;&#x82D7;&#x4E0A;&#x6253;&#x5370;&#x51FA;&#x6765;Hello&#xFF0C;RISCV World&#xFF01;&#x7684;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x7C7B;&#x6BD4;&#x4E8E;linux&#xFF0C;&#x5C06;rcore&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x5728;&#x706B;&#x82D7;&#x4E0A;&#x542F;&#x52A8;&#x8D77;&#x6765;&#x3002;</p>
<p>&#x5728;sw&#x7684;&#x6587;&#x4EF6;&#x5939;&#x91CC;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x4E09;&#x4E2A;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#xFF0C;riscv-linux&#xFF0C;riscv-pk&#xFF0C;riscv-rootfs&#x3002;&#x4E09;&#x8005;&#x7F3A;&#x4E00;&#x4E0D;&#x53EF;&#xFF0C;riscv-linux&#x662F;os&#x7684;&#x5185;&#x6838;&#xFF0C;riscv-pk&#x91CC;&#x7684;bbl&#xFF08;Berkeley Boot Loader&#xFF09;&#x662F;os&#x7684;bootloader&#xFF0C;riscv-rootfs&#x662F;os&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x4E09;&#x8005;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x5C31;&#x662F;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x770B;&#xFF0C;&#x4E09;&#x4E2A;&#x5404;&#x81EA;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4EE5;&#x53CA;&#x4E09;&#x8005;&#x662F;&#x600E;&#x4E48;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x7684;&#x3002;</p>
<p>&#x7C7B;&#x6BD4;&#x4E8E;rcore&#x5728;&#x706B;&#x82D7;&#x4E0A;&#x7684;&#x79FB;&#x690D;&#xFF0C;&#x540C;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;os&#x7684;&#x5185;&#x6838;&#xFF0C;&#x5C31;&#x662F;xy_os&#xFF0C;&#x9700;&#x8981;os&#x7684;bootloader&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x91C7;&#x7528;&#x8BA1;&#x7B97;&#x6240;&#x63D0;&#x4F9B;&#x7684;bbl&#xFF0C;&#x9700;&#x8981;os&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6211;&#x4EEC;&#x5728;&#x540E;&#x9762;&#x518D;&#x9610;&#x8FF0;&#xFF0C;&#x5F53;&#x4E0B;&#x6211;&#x4EEC;&#x9700;&#x8981;bbl&#x548C;kernel&#x7ED3;&#x5408;&#x8D77;&#x6765;&#xFF0C;&#x4F7F;rcore&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x628A;&#x76EE;&#x5149;&#x805A;&#x7126;&#x4E8E;&#x5185;&#x6838;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;rCore_tutorial&#x5728;&#x4E2D;&#xFF0C;&#x5173;&#x4E8E;bootloader&#x7684;&#x7BC7;&#x5E45;&#x57FA;&#x672C;&#x4E0A;&#x6CA1;&#x6709;&#xFF0C;&#x5728;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;rcore&#x7248;&#x672C;&#x91CC;&#x9762;&#xFF0C;&#xFF08;&#x6CA1;&#x9519;rcore&#x5DF2;&#x7ECF;&#x7ECF;&#x8FC7;&#x4E86;&#x597D;&#x51E0;&#x4EE3;&#x7684;&#x8FED;&#x4EE3;&#x4E86;&#xFF0C;&#x5411;&#x5F00;&#x62D3;&#x8005;&#x81F4;&#x656C;&#xFF0C;&#x4ECE;&#x4E00;&#x5F00;&#x59CB;&#x7684;32&#x4F4D;rcore&#x5230;64&#x4F4D;rocre&#xFF0C;bootloader&#x4E5F;&#x66F4;&#x6362;&#x8FC7;&#x597D;&#x51E0;&#x6B21;&#xFF0C;&#x6700;&#x521D;&#x91C7;&#x7528;&#x7684;&#x5C31;&#x662F;bbl&#xFF0C;&#x540E;&#x9762;&#x53C8;&#x6362;&#x6210;&#x4E86;&#x5916;&#x7F6E;&#x7684;opensbi3&#x70B9;&#x51E0;&#x7248;&#x672C;&#xFF0C;&#x76F4;&#x5230;&#x73B0;&#x5728;qemu&#x91CC;&#x76F4;&#x63A5;&#x5185;&#x7F6E;&#x4E86;opensbi&#x4F5C;&#x4E3A;riscv&#x7684;&#x9ED8;&#x8BA4;&#x7684;bootloader&#xFF09;&#x800C;bootloader&#x5728;&#x9762;&#x5411;&#x4E00;&#x4E2A;&#x771F;&#x5B9E;&#x7684;&#x786C;&#x4EF6;&#x73AF;&#x5883;&#x662F;&#x5341;&#x5206;&#x91CD;&#x8981;&#x7684;&#x3002;</p>
<p><strong>&#x6CE8;1</strong>&#xFF1A;&#x5177;&#x4F53;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x90FD;&#x5728;rCore_tutorial&#x91CC;&#x9762;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x505A;&#x8865;&#x5145;&#xFF0C;&#x8865;&#x5145;&#x4E9B;&#x6559;&#x7A0B;&#x4E2D;&#x6CA1;&#x6709;&#x63D0;&#x53CA;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#x3002;&#x5927;&#x5BB6;&#x9700;&#x8981;&#x4E24;&#x8005;&#x7ED3;&#x5408;&#x7740;&#x6765;&#x770B;&#x3002;</p>
<p><strong>&#x6CE8;2</strong>&#xFF1A;&#x6211;&#x4F1A;&#x6309;&#x7167;rCore_tutorial&#x6559;&#x7A0B;&#x7AE0;&#x8282;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x8FDB;&#x884C;&#x8865;&#x5145;&#x8BF4;&#x660E;&#x3002;</p>
<h2 id="kernel">kernel</h2>
<p>&#x5728; <strong>&#x7F16;&#x8BD1;&#x3001;&#x751F;&#x6210;&#x5185;&#x6838;&#x955C;&#x50CF;</strong>&#x8FD9;&#x4E00;&#x7AE0;&#x8282;&#x4E2D;&#xFF0C;</p>
<p>&#x6211;&#x4EEC;&#x5BF9;&#x5DF2;&#x7ECF;&#x751F;&#x6210;&#x7684;os &#x67E5;&#x770B;&#x6587;&#x4EF6;&#x7C7B;&#x578B;</p>
<pre><code class="lang-bash">$ file target/riscv64imac-unknown-none-elf/debug/os
target/riscv64imac-unknown-none-elf/debug/os: ELF 64-bit LSB executable, UCB RISC-V, version 1 (SYSV), statically linked, with debug_info, not stripped
</code></pre>
<p>&#x6211;&#x4EEC;&#x540C;&#x6837;&#x6765;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x8BA1;&#x7B97;&#x6240;&#x5BF9;&#x5E94;&#x4E0B;&#x7684;&#x751F;&#x6210;&#x7684;os&#x6587;&#x4EF6;&#x7C7B;&#x578B;</p>
<pre><code class="lang-bash">$ file sw/riscv-linux/vmlinux
sw/riscv-linux/vmlinux: ELF 64-bit LSB executable, UCB RISC-V, version 1 (SYSV), statically linked, BuildID[sha1]=b84fe38b14ccd10fcf0a4c6f766b5b2b2a23116b, not stripped
</code></pre>
<p>&#x57FA;&#x672C;&#x4E0A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5DEE;&#x522B;&#xFF0C;&#x5F88;&#x5E78;&#x8FD0;&#xFF0C;&#x8FD9;&#x5C31;&#x4EE3;&#x8868;&#x7740;rcore&#x5728;qemu&#x4E0A;&#x6A21;&#x62DF;&#x7684;&#x771F;&#x5B9E;&#x73AF;&#x5883;&#x548C;&#x6211;&#x4EEC;&#x5728;&#x706B;&#x82D7;&#x4E0A;&#x8981;&#x8FD0;&#x884C;&#x7684;&#x771F;&#x5B9E;&#x73AF;&#x5883;&#x652F;&#x6301;&#x57FA;&#x672C;&#x4E0A;&#x6CA1;&#x6709;&#x5DEE;&#x522B;&#x3002;&#xFF08;&#x540C;&#x65F6;&#x4E5F;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x76EE;&#x6807;&#x4E09;&#x5143;&#x7EC4;&#x91CC;&#x7684;&#x914D;&#x7F6E;&#xFF09;</p>
<p>&#x540C;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5229;&#x7528;&#x6559;&#x7A0B;&#x91CC;&#x63D0;&#x4F9B;&#x7684;&#x5DE5;&#x5177;<code>rust-objdump</code>&#x4E5F;&#x6765;&#x67E5;&#x770B;&#x4E00;&#x4E0B;vmlinux&#x7684;&#x5177;&#x4F53;&#x4FE1;&#x606F;&#x3002;</p>
<pre><code class="lang-bash">$ rust-objdump sw/riscv-linux/vmlinux -x --arch-name=riscv64

sw/riscv-linux/vmlinux:    file format ELF64-riscv

architecture: riscv64
start address: 0xffffffff80000000

Sections:
Idx Name          Size     VMA              LMA              Type
  0               00000000 0000000000000000 0000000000000000 
  1 .init.text    0000c5f4 ffffffff80000000 0000000000000000 TEXT 
  2 .init.data    0000ac08 ffffffff8000d000 000000000000d000 DATA 
  3 .exit.text    00000038 ffffffff80017c08 0000000000017c08 TEXT 
  4 .data..percpu 00003d60 ffffffff80018000 0000000000018000 DATA 
  5 .text         000e639e ffffffff8001bd60 000000000001bd60 TEXT 
  6 .softirqentry.text 00000236 ffffffff801020fe 00000000001020fe TEXT 
  7 .rodata       00025e98 ffffffff80102340 0000000000102340 DATA 
  8 __param       000005c8 ffffffff801281d8 00000000001281d8 DATA 
  9 __modver      00000020 ffffffff801287a0 00000000001287a0 BSS
 10 .srodata      000000d0 ffffffff801287c0 00000000001287c0 DATA 
 11 .data         00017ae0 ffffffff80129000 0000000000129000 DATA 
 12 __bug_table   00000f10 ffffffff80140ae0 0000000000140ae0 DATA 
 13 .sdata        0000115c ffffffff801419f0 00000000001419f0 DATA 
 14 .bss          0001a3e8 ffffffff80143000 0000000000143000 BSS
 15 __ex_table    00000810 ffffffff8015d3f0 000000000015d3f0 DATA 
 16 .notes        00000024 ffffffff8015dc00 000000000015dc00 
 17 .comment      00000011 0000000000000000 0000000000000000 
 18 .symtab       0003fb88 0000000000000000 0000000000000000 
 19 .strtab       0002b3b2 0000000000000000 0000000000000000 
 20 .shstrtab     000000b2 0000000000000000 0000000000000000 

SYMBOL TABLE:
ffffffff80000000 l    d  .init.text    00000000 .init.text
ffffffff8000d000 l    d  .init.data    00000000 .init.data
...
</code></pre>
<p>&#x5F62;&#x5F0F;&#x5F88;&#x50CF;&#x6559;&#x7A0B;&#x91CC;rcore&#x5448;&#x73B0;&#x51FA;&#x6765;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;&#x70B9;&#x662F;&#xFF0C;vmlinux&#x7684;start address&#x662F;0xffffffff80000000&#xFF0C;&#x5F88;&#x660E;&#x663E;&#x662F;&#x5728;&#x9AD8;&#x5730;&#x5740;&#x4F4D;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x662F;&#x4E2A;&#x865A;&#x62DF;&#x5730;&#x5740;&#x3002;&#x8FD9;&#x867D;&#x7136;&#x53EA;&#x662F;&#x4E2A;&#x53EA;&#x80FD;&#x6253;&#x5370;&#x4E2A;hello&#xFF0C;world&#x7684;&#x6700;&#x5C0F;&#x6838;&#x7684;linux&#xFF0C;&#x4F46;&#x5F00;&#x542F;&#x5206;&#x9875;&#x673A;&#x5236;&#xFF0C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5374;&#x4E00;&#x6837;&#x4E0D;&#x5C11;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5148;&#x628A;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x653E;&#x4E0B;&#xFF0C;&#x7EE7;&#x7EED;&#x5F80;&#x540E;&#x8D70;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5C06;&#x4E0A;&#x8FF0;&#x547D;&#x4EE4;&#x4E2D;&#x7684;-d&#x6362;&#x6210;-x&#x6765;&#x67E5;&#x770B;linux&#x5185;&#x6838;&#x7684;&#x53CD;&#x6C47;&#x7F16;&#x4FE1;&#x606F;&#x3002;</p>
<pre><code class="lang-bash"> $ rust-objdump sw/riscv-linux/vmlinux <span class="hljs-_">-d</span> --arch-name=riscv64

sw/riscv-linux/vmlinux:    file format ELF64-riscv


Disassembly of section .init.text:

ffffffff80000000 _start:
ffffffff80000000: 73 10 40 10              csrw    sie, zero
ffffffff80000004: 97 21 14 00              auipc    gp, 322
ffffffff80000008: 93 81 c1 1e              addi    gp, gp, 492
ffffffff8000000c: 99 62                    lui    t0, 6
ffffffff8000000e: 73 b0 02 10              csrc    sstatus, t0
ffffffff80000012: 93 86 01 cc              addi    a3, gp, -832
ffffffff80000016: 05 46                    addi    a2, zero, 1
ffffffff80000018: af a6 c6 00              &lt;unknown&gt;
ffffffff8000001c: c9 ee                    bnez    a3, 154
ffffffff8000001e: 2a 84                    add    s0, zero, a0
ffffffff80000020: ae 84                    add    s1, zero, a1
ffffffff80000022: 17 c1 12 00              auipc    sp, 300
ffffffff80000026: 13 01 e1 fd              addi    sp, sp, -34
ffffffff8000002a: ef 10 b0 19              jal    6554
ffffffff8000002e: ef 00 80 02              jal    40
ffffffff80000032: 17 22 13 00              auipc    tp, 306
ffffffff80000036: 13 02 e2 a4              addi    tp, tp, -1458
ffffffff8000003a: 23 24 82 02              sw    s0, 40(tp)
ffffffff8000003e: 17 a1 12 00              auipc    sp, 298
ffffffff80000042: 13 01 21 <span class="hljs-built_in">fc</span>              addi    sp, sp, -62
ffffffff80000046: 09 65                    lui    a0, 2
ffffffff80000048: 2a 91                    add    sp, sp, a0
ffffffff8000004a: 22 85                    add    a0, zero, s0
ffffffff8000004c: a6 85                    add    a1, zero, s1
ffffffff8000004e: ef 10 b0 20              jal    6666
ffffffff80000052: 6f 00 40 46              j    1124

ffffffff80000056 relocate:
ffffffff80000056: b7 05 00 80              lui    a1, 524288
ffffffff8000005a: 17 05 00 00              auipc    a0, 0
ffffffff8000005e: 13 05 65 fa              addi    a0, a0, -90
ffffffff80000062: 89 8d                    sub    a1, a1, a0
ffffffff80000064: ae 90                    add    ra, ra, a1
...
</code></pre>
<p>&#x5F88;&#x6E05;&#x6670;&#xFF0C;&#x6839;&#x636E;&#x53CD;&#x6C47;&#x7F16;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x770B;&#x51FA;&#x5185;&#x6838;&#x5728;&#x542F;&#x52A8;&#x4F0A;&#x59CB;&#x6267;&#x884C;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x662F;&#x4EC0;&#x4E48;&#x4E2A;&#x610F;&#x601D;&#x5462;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x6DF1;&#x5165;&#x5230;linux&#x5185;&#x6838;&#x4EE3;&#x7801;&#x91CC;&#xFF0C;&#x770B;&#x770B;&#x662F;&#x5982;&#x4F55;&#x4E00;&#x6B65;&#x6B65;&#x542F;&#x52A8;&#x8D77;&#x6765;&#x7684;&#x3002;</p>
<p>riscv-linux/arch/riscv/kernel/head.S</p>
<pre><code class="lang-ASM">__INIT
ENTRY(_start)
    /* Mask all interrupts */
    csrw sie, zero

    /* Load the global pointer */
.option push
.option norelax
    la gp, __global_pointer$
.option pop

    /*
     * Disable FPU to detect illegal usage of
     * floating point in kernel space
     */
    li t0, SR_FS
    csrc sstatus, t0

    /* Pick one hart to run the main boot sequence */
    la a3, hart_lottery
    li a2, 1
    amoadd.w a3, a2, (a3)
    bnez a3, .Lsecondary_start

    /* Save hart ID and DTB physical address */
    mv s0, a0
    mv s1, a1

    /* Initialize page tables and relocate to virtual addresses */
    la sp, init_thread_union + THREAD_SIZE
    call setup_vm
    call relocate

    /* Restore C environment */
    la tp, init_task
    sw s0, TASK_TI_CPU(tp)

    la sp, init_thread_union
    li a0, ASM_THREAD_SIZE
    add sp, sp, a0

    /* Start the kernel */
    mv a0, s0
    mv a1, s1
    call parse_dtb
    tail start_kernel

relocate:
    /* Relocate return address */
    li a1, PAGE_OFFSET
    la a0, _start
    sub a1, a1, a0
    add ra, ra, a1

    /* Point stvec to virtual address of intruction after satp write */
    la a0, 1f
    add a0, a0, a1
    csrw stvec, a0

    /* Compute satp for kernel page tables, but don&apos;t load it yet */
    la a2, swapper_pg_dir
    srl a2, a2, PAGE_SHIFT
    li a1, SATP_MODE
    or a2, a2, a1

    /*
     * Load trampoline page directory, which will cause us to trap to
     * stvec if VA != PA, or simply fall through if VA == PA
     */
    la a0, trampoline_pg_dir
    srl a0, a0, PAGE_SHIFT
    or a0, a0, a1
    sfence.vma
    csrw sptbr, a0
    ...
</code></pre>
<p>&#x8FD9;&#x662F;kernel&#x5728;&#x6700;&#x521D;&#x542F;&#x52A8;&#x65F6;&#x7684;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8FD9;&#x548C;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x53CD;&#x6C47;&#x7F16;&#x51FA;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x57FA;&#x672C;&#x4E0A;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x3002;&#xFF08;&#x672C;&#x6765;&#x5C31;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x6837;&#x7684;hhhhh&#xFF09;&#x3002;</p>
<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x82F1;&#x6587;&#x6CE8;&#x91CA;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x6E05;&#x6670;&#x6BCF;&#x4E00;&#x6B65;&#x5728;&#x5E72;&#x4EC0;&#x4E48;&#xFF0C;&#x9996;&#x5148;&#x5C4F;&#x853D;&#x6240;&#x6709;&#x7684;&#x4E2D;&#x65AD;&#xFF0C;&#x52A0;&#x8F7D;&#x5168;&#x5C40;&#x6307;&#x9488;&#xFF0C;&#x4F7F;&#x80FD;&#x9875;&#x8868;&#x548C;&#x91CD;&#x5B9A;&#x4F4D;&#x5230;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x611F;&#x89C9;linux&#x7684;&#x542F;&#x52A8;&#x5F88;&#x590D;&#x6742;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x53C8;&#x8981;&#x4E2D;&#x65AD;&#xFF0C;&#x53C8;&#x8981;&#x5206;&#x9875;&#x4EC0;&#x4E48;&#x7684;&#xFF0C;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x597D;&#x50CF;&#x8FD8;&#x6CA1;&#x6709;&#x5230;&#x4E2A;&#x6C34;&#x5E73;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x60F3;&#x8F93;&#x51FA;&#x4E2A;hello world&#x5C31;&#x884C;&#x4E86;&#x5440;&#x3002;&#x7684;&#x786E;&#xFF0C;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x8FD8;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x9002;&#x7528;&#x4E8E;&#x5206;&#x6790;rcore&#x7684;&#x5DE5;&#x5177;&#x540C;&#x6837;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x7684;linux&#xFF0C;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x653E;&#x5FC3;&#x4E86;&#x8BB8;&#x591A;&#xFF0C;&#x6BD5;&#x7ADF;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8E29;&#x5728;&#x5DE8;&#x4EBA;&#x7684;&#x80A9;&#x8180;&#x4E0A;&#x6765;&#x7EE7;&#x7EED;&#x6211;&#x4EEC;&#x7684;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;</p>
<p><strong>&#x4F7F;&#x7528;&#x94FE;&#x63A5;&#x811A;&#x672C;&#x6307;&#x5B9A;&#x7A0B;&#x5E8F;&#x5185;&#x5B58;&#x5E03;&#x5C40;</strong></p>
<p>&#x5728;rCore_tutorial&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5185;&#x6838;&#x88AB;&#x653E;&#x5728;&#x4E86;&#x94FE;&#x63A5;&#x5730;&#x5740;0x80200000&#x5904;&#x3002;</p>
<blockquote>
<pre><code class="lang-clike">// src/boot/linker64.ld

OUTPUT_ARCH(riscv)
ENTRY(_start)

BASE_ADDRESS = 0x80200000;
</code></pre>
</blockquote>
<p>&#x56E0;&#x4E3A;&#x6839;&#x636E;rCore_tutorial&#x8BF4;&#x660E;&#xFF0C;opensbi&#x5C06;&#x81EA;&#x8EAB;&#x653E;&#x5728;&#x4E86;0x8000000&#x5904;&#xFF0C;&#x5B8C;&#x6210;&#x521D;&#x59CB;&#x5316;&#x540E;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230; 0x80200000&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x5728;&#x706B;&#x82D7;&#x4E0A;&#xFF0C;bbl&#x5C06;&#x81EA;&#x8EAB;&#x653E;&#x5728;&#x4E86;&#x54EA;&#x91CC;&#x5462;&#xFF0C;&#x5B8C;&#x6210;&#x521D;&#x59CB;&#x5316;&#x540E;&#x53C8;&#x8DF3;&#x8F6C;&#x5230;&#x54EA;&#x91CC;&#x6765;&#x8FDB;&#x5165;&#x5230;&#x5185;&#x6838;&#x5462;&#xFF1F;&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x4EE5;&#x524D;&#x63D0;&#x5230;&#x7684;start address: 0xffffffff80000000&#x561B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x53C8;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x6765;&#x6DF1;&#x5165;&#x67E5;&#x770B;&#x4E0B;&#x6E90;&#x7801;&#x3002;</p>
<p>0.dts</p>
<pre><code class="lang-c">L10: memory@<span class="hljs-number">100000000</span> {
        device_type = <span class="hljs-string">&quot;memory&quot;</span>;
        reg = &lt;<span class="hljs-number">0x1</span> <span class="hljs-number">0x0</span> <span class="hljs-number">0x0</span> <span class="hljs-number">0x20000000</span>&gt;;
    };
</code></pre>
<p>&#x6839;&#x636E;&#x8BA1;&#x7B97;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x706B;&#x82D7;&#x786C;&#x4EF6;dts&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF08;divece tree source &#x91CC;&#x7684;&#x90FD;&#x662F;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF09;&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x662F;0x100000000&#xFF0C;&#x662F;&#x5426;&#x5C31;&#x610F;&#x5473;&#x7740;bbl&#x5E94;&#x8BE5;&#x88AB;&#x653E;&#x5728;&#x4E86;0x100000000&#x5904;&#x4E86;&#x5462;&#xFF1F;</p>
<p>sw/riscv-pk/bbl/bbl.lds </p>
<pre><code class="lang-c"><span class="hljs-comment">/* See LICENSE for license details. */</span>                                                    

OUTPUT_ARCH( <span class="hljs-string">&quot;riscv&quot;</span> )

ENTRY( reset_vector )

SECTIONS
{

  <span class="hljs-comment">/*--------------------------------------------------------------------*/</span>
  <span class="hljs-comment">/* Code and read-only segment                                         */</span>  
  <span class="hljs-comment">/*--------------------------------------------------------------------*/</span>

  <span class="hljs-comment">/* Begining of code and text segment */</span>
  . = <span class="hljs-number">0x100000000</span>;
  _ftext = .;
  PROVIDE( eprol = . );
...
</code></pre>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x7684;&#x786E;&#xFF0C;bbl.lds&#x9A8C;&#x8BC1;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x60F3;&#x6CD5;&#xFF0C;bbl&#x786E;&#x5B9E;&#x88AB;&#x653E;&#x5728;&#x4E86;0x100000000&#x5904;&#xFF0C;&#x597D;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x5185;&#x6838;&#x5E94;&#x8BE5;&#x88AB;&#x653E;&#x5728;&#x54EA;&#x5462;&#xFF1F;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#xFF0C;&#x80AF;&#x5B9A;&#x5E94;&#x8BE5;&#x653E;&#x5728;&#x6BD4;0x10000000&#x540E;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x90A3;&#x4E48;&#x5177;&#x4F53;&#x653E;&#x5728;&#x54EA;&#x5462;&#xFF1F;</p>
<p>riscv-linux/arch/riscv/kernel/vmlinux.lds</p>
<pre><code class="lang-c">OUTPUT_ARCH(riscv)
ENTRY(_start)
jiffies = jiffies_64;
SECTIONS
{
 . = <span class="hljs-number">0xffffffff80000000</span>;
 _start = .;
 __init_begin = .;
 .head.text : AT(ADDR(.head.text) - <span class="hljs-number">0xffffffff80000000</span>) { KEEP(*(.head.text)) }
 ...
</code></pre>
<p>&#x548C;&#x6211;&#x4EEC;&#x53CD;&#x6C47;&#x7F16;&#x51FA;&#x6765;&#x7684;&#x7ED3;&#x679C;&#x4E00;&#x6837;&#xFF0C;&#x5185;&#x6838;&#x88AB;&#x653E;&#x5728;&#x4E86;0xffffffff80000000&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x8FD8;&#x6CA1;&#x6709;&#x8FDB;&#x5165;&#x5230;&#x865A;&#x65E0;&#x7F25;&#x7F08;&#x7684;&#x865A;&#x62DF;&#x7A7A;&#x95F4;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;0xffffffff80000000&#x5BF9;&#x5E94;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x5728;&#x54EA;&#x5462;&#xFF1F;&#x6211;&#x4E5F;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x5206;&#x9875;&#x673A;&#x5236;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x7EBF;&#x6027;&#x6620;&#x5C04;&#xFF0C;&#x800C;&#x662F;&#x81EA;&#x6620;&#x5C04;&#xFF0C;&#x627E;&#x5230;&#x6E90;&#x4EE3;&#x7801;&#x597D;&#x50CF;&#x6709;&#x70B9;&#x96BE;&#x5EA6;&#x54DF;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x6362;&#x79CD;&#x601D;&#x8DEF;&#x3002;</p>
<p>&#x8FD8;&#x8BB0;&#x5F97;&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x6211;&#x4EEC;&#x5728;&#x706B;&#x82D7;&#x4E0A;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x8DD1;&#x8D77;&#x6765;&#x4E86;linux.bin&#x4E86;&#x5417;&#x3002;&#x6253;&#x5370;&#x51FA;&#x4E86;&#x4E00;&#x5927;&#x957F;&#x6BB5;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x91CC;&#x9762;&#x5C31;&#x6709;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x770B;&#x3002;</p>
<pre><code>bbl loader
SBI console now online
line 183: hartid = 0, build time: 18:01:03 Mar 19 2020
Use external dtb.
querying memory
querying hart
querying clint
querying plic
init plic
init hart plic
init memory
boot loader
moving dtb from 0x0000000100000008 to 0x0000000100400000
              vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
                  vvvvvvvvvvvvvvvvvvvvvvvvvvvv
rrrrrrrrrrrrr       vvvvvvvvvvvvvvvvvvvvvvvvvv
rrrrrrrrrrrrrrrr      vvvvvvvvvvvvvvvvvvvvvvvv
rrrrrrrrrrrrrrrrrr    vvvvvvvvvvvvvvvvvvvvvvvv
rrrrrrrrrrrrrrrrrr    vvvvvvvvvvvvvvvvvvvvvvvv
rrrrrrrrrrrrrrrrrr    vvvvvvvvvvvvvvvvvvvvvvvv
rrrrrrrrrrrrrrrr      vvvvvvvvvvvvvvvvvvvvvv  
rrrrrrrrrrrrr       vvvvvvvvvvvvvvvvvvvvvv    
rr                vvvvvvvvvvvvvvvvvvvvvv      
rr            vvvvvvvvvvvvvvvvvvvvvvvv      rr
rrrr      vvvvvvvvvvvvvvvvvvvvvvvvvv      rrrr
rrrrrr      vvvvvvvvvvvvvvvvvvvvvv      rrrrrr
rrrrrrrr      vvvvvvvvvvvvvvvvvv      rrrrrrrr
rrrrrrrrrr      vvvvvvvvvvvvvv      rrrrrrrrrr
rrrrrrrrrrrr      vvvvvvvvvv      rrrrrrrrrrrr
rrrrrrrrrrrrrr      vvvvvv      rrrrrrrrrrrrrr
rrrrrrrrrrrrrrrr      vv      rrrrrrrrrrrrrrrr
rrrrrrrrrrrrrrrrrr          rrrrrrrrrrrrrrrrrr
rrrrrrrrrrrrrrrrrrrr      rrrrrrrrrrrrrrrrrrrr
rrrrrrrrrrrrrrrrrrrrrr  rrrrrrrrrrrrrrrrrrrrrr

       INSTRUCTION SETS WANT TO BE FREE
[    0.000000] OF: fdt: Ignoring memory range 0x100000000 - 0x100200000
  ...
</code></pre><p>&#x6253;&#x5370;&#x4FE1;&#x606F;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#xFF1A;<code>Ignoring memory range 0x100000000 - 0x100200000</code>bbl&#x8D77;&#x59CB;&#x5730;&#x5740;&#x521A;&#x597D;&#x662F;0x10000000&#xFF0C;&#x6070;&#x597D;mask&#x5230;0x100200000&#xFF0C;&#x611F;&#x89C9;&#x6709;&#x70B9;&#x610F;&#x601D;&#x3002;</p>
<p>&#x662F;&#x7684;&#xFF0C;&#x5185;&#x6838;&#x662F;&#x653E;&#x5728;0x100200000&#x8FD9;&#x4E2A;&#x7269;&#x7406;&#x5730;&#x5740;&#x4E0A;&#x7684;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C06;0x80020000&#x94FE;&#x63A5;&#x5730;&#x5740;&#x6539;&#x4E3A;0x100200000&#x5373;&#x53EF;&#x3002;</p>
<pre><code class="lang-C"><span class="hljs-comment">// src/boot/linker64.ld</span>

OUTPUT_ARCH(riscv)
ENTRY(_start)

BASE_ADDRESS = <span class="hljs-number">0x100200000</span>;
</code></pre>
<p>&#x4F7F;&#x7528;rust-objdump&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;</p>
<pre><code class="lang-bash">$ rust-objdump target/riscv64imac-unknown-none-elf/debug/xy_os -h --arch-name=riscv64
</code></pre>
<p><strong>&#x91CD;&#x5199;&#x7A0B;&#x5E8F;&#x5165;&#x53E3;&#x70B9; <code>_start</code></strong></p>
<p>&#x8BF4;&#x660E;&#xFF1A;&#x5173;&#x4E8E;riscv&#x7684;M&#x6001;&#x548C;S&#x6001;&#xFF0C;&#x6211;&#x7684;&#x7B80;&#x5355;&#x7406;&#x89E3;&#x662F;&#x5728;bbl&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x65F6;&#x5904;&#x4E8E;M&#x6001;&#xFF0C;&#x4E00;&#x65E6;&#x8DF3;&#x8F6C;&#x5230;&#x4E86;&#x5185;&#x6838;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#x8DF3;&#x5230;&#x4E86;0x100200000&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7B2C;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#xFF09;&#xFF0C;&#x5C31;&#x5904;&#x4E8E;S&#x6001;&#x4E86;&#x3002;</p>
<blockquote>
<p><strong>riscv64 &#x7684; M Mode</strong></p>
<p>M-mode(&#x673A;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x7F29;&#x5199;&#x4E3A; M &#x6A21;&#x5F0F;)&#x662F; RISC-V &#x4E2D; hart(hardware thread,&#x786C;&#x4EF6;&#x7EBF;&#x7A0B;)&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x7684;&#x6700;&#x9AD8;&#x6743;&#x9650;&#x6A21;&#x5F0F;&#x3002;&#x5728; M &#x6A21;&#x5F0F;&#x4E0B;&#x8FD0;&#x884C;&#x7684; hart &#x5BF9;&#x5185;&#x5B58;,I/O &#x548C;&#x4E00;&#x4E9B;&#x5BF9;&#x4E8E;&#x542F;&#x52A8;&#x548C;&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#x5FC5;&#x8981;&#x7684;&#x5E95;&#x5C42;&#x529F;&#x80FD;&#x6709;&#x7740;&#x5B8C;&#x5168;&#x7684;&#x4F7F;&#x7528;&#x6743;&#x3002;</p>
<p><strong>riscv64 &#x7684; S Mode</strong></p>
<p>S-mode(&#x76D1;&#x7BA1;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;&#x7F29;&#x5199;&#x4E3A; S &#x6A21;&#x5F0F;)&#x662F;&#x652F;&#x6301;&#x73B0;&#x4EE3;&#x7C7B; Unix &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x6743;&#x9650;&#x6A21;&#x5F0F;&#xFF0C;&#x652F;&#x6301;&#x73B0;&#x4EE3;&#x7C7B; Unix &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6240;&#x9700;&#x8981;&#x7684;&#x57FA;&#x4E8E;&#x9875;&#x9762;&#x7684;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x673A;&#x5236;&#x662F;&#x5176;&#x6838;&#x5FC3;&#x3002;</p>
</blockquote>
<p>&#x786E;&#x5B9A;&#x597D;&#x7269;&#x7406;&#x5730;&#x5740;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x7740;&#x624B;&#x4E3A;&#x5185;&#x6838;&#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#x4E86;&#x3002;&#x8FD8;&#x8BB0;&#x5F97;riscv-linux/arch/riscv/kernel/head.S&#x91CC;&#x4E3A;linux&#x542F;&#x52A8;&#x505A;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x51C6;&#x5907;&#x561B;&#x3002;&#x540C;&#x6837;&#x5730;&#xFF0C;rcore&#x4E5F;&#x9700;&#x8981;&#xFF0C;&#x53EA;&#x662F;&#x6CA1;&#x90A3;&#x4E48;&#x590D;&#x6742;&#x3002;</p>
<p>src/boot/entry64.asm</p>
<pre><code class="lang-riscv">    .section .text.entry
    .globl _start
_start:
    la sp, bootstacktop
    call rust_main

    .section .bss.stack
    .align 12
    .global bootstack
bootstack:
    .space 4096 * 4
    .global bootstacktop
bootstacktop:
</code></pre>
<p>&#x76F8;&#x6BD4;&#x4E8E;head.S&#x7684;mask&#x4E2D;&#x65AD;&#xFF0C;&#x4F7F;&#x80FD;&#x5206;&#x9875;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x5355;&#x7EAF;&#x5730;&#x5F00;&#x8F9F;&#x4E86;4096 * 4&#x5927;&#x5C0F;&#x7684;&#x5806;&#x6808;&#x3002;&#x7136;&#x540E;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x7ED9;&#x5927;&#x5BB6;&#x4E00;&#x4E2A;&#x66F4;&#x76F4;&#x89C2;&#x7684;&#x8BA4;&#x8BC6;&#x3002;</p>
<p><img src="https://img2018.cnblogs.com/blog/361409/201908/361409-20190812195516959-1923406042.png" alt="361409-20190812195516959-1923406042"></p>
<blockquote>
<p>RV32I &#x4E3A;&#x7A0B;&#x5E8F;&#x548C;&#x6570;&#x636E;&#x5206;&#x914D;&#x5185;&#x5B58;&#x3002;&#x56FE;&#x4E2D;&#x7684;&#x9876;&#x90E8;&#x662F;&#x9AD8;&#x5730;&#x5740;&#xFF0C;&#x5E95;&#x90E8;&#x662F;&#x4F4E;&#x5730;&#x5740;&#x3002;&#x5728; RISC-V &#x8F6F;&#x4EF6;&#x89C4;&#x8303;&#x4E2D;&#xFF0C;&#x6808;&#x6307;&#x9488;&#xFF08;sp&#xFF09;&#x4ECE; 0xbffffff0 &#x5F00;&#x59CB;&#x5411;&#x4E0B;&#x589E;&#x957F;&#xFF1B;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x6BB5;&#x4ECE; 0x00010000 &#x5F00;&#x59CB;&#xFF0C;&#x5305;&#x62EC;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF1B;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x6BB5;&#x7ED3;&#x675F;&#x540E;&#x662F;&#x9759;&#x6001;&#x6570;&#x636E;&#x533A;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x5047;&#x8BBE;&#x4ECE; 0x10000000 &#x5F00;&#x59CB;&#xFF1B;&#x7136;&#x540E;&#x662F;&#x52A8;&#x6001;&#x6570;&#x636E;&#x533A;&#xFF0C;&#x7531; C &#x8BED;&#x8A00;&#x4E2D;&#x7684;alloc()&#x51FD;&#x6570;&#x5206;&#x914D;&#xFF0C;&#x5411;&#x4E0A;&#x589E;&#x957F;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x3002;</p>
</blockquote>
<p><a href="https://www.cnblogs.com/mikewolf2002/p/11323406.html" target="_blank">riscv&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;</a></p>
<p><strong>&#x6CE8;1</strong>&#xFF1A;&#x56FE;&#x4E2D;&#x5730;&#x5740;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x4EC5;&#x9650;&#x4E8E;&#x56FE;&#x4E2D;&#x4EE5;&#x53CA;&#x7D27;&#x968F;&#x56FE;&#x4E0B;&#x7684;&#x8BF4;&#x660E;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x5F00;&#x8F9F;&#x4E86;&#x5806;&#x6808;&#xFF0C;&#x6309;&#x7406;&#x8BF4;&#x8FD8;&#x9700;&#x8981;&#x52A8;&#x6001;&#x5806;&#x4EE5;&#x53CA;&#x9759;&#x6001;&#x6570;&#x636E;&#x540E;&#x624D;&#x540E;&#x63A5;&#x7740;&#x4EE3;&#x7801;&#x6BB5;&#xFF08;&#x4E5F;&#x5C31;&#x662F;call rust_main)&#x3002;rcore&#x76F4;&#x63A5;&#x4F7F;&#x5728;&#x6808;&#x540E;&#x63A5;&#x4E86;&#x4EE3;&#x7801;&#x6BB5;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5728;&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x80FD;&#x7533;&#x8BF7;&#x6808;&#x7A7A;&#x95F4;&#x6765;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x7533;&#x8BF7;&#x5806;&#x7A7A;&#x95F4;&#x3002;</p>
<p><strong>&#x4F7F;&#x7528; Qemu &#x8FD0;&#x884C;&#x5185;&#x6838;</strong></p>
<pre><code class="lang-rust"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">rust_main</span></span>() -&gt; ! {
    <span class="hljs-comment">// &#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x8F93;&#x51FA; &quot;OK\n&quot; &#xFF0C;&#x968F;&#x540E;&#x8FDB;&#x5165;&#x6B7B;&#x5FAA;&#x73AF;</span>
    console_putchar(<span class="hljs-string">b&apos;O&apos;</span>);
    console_putchar(<span class="hljs-string">b&apos;K&apos;</span>);
    console_putchar(<span class="hljs-string">b&apos;\n&apos;</span>);
    <span class="hljs-keyword">loop</span> {}
}
</code></pre>
<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7684;ok&#x662F;&#x5B58;&#x50A8;&#x5728;&#x6808;&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6362;&#x4E00;&#x79CD;&#x5F62;&#x5F0F;&#x3002;</p>
<pre><code class="lang-rust"><span class="hljs-keyword">static</span> HELLO: &amp;[<span class="hljs-keyword">u8</span>] = <span class="hljs-string">b&quot;Hello World!&quot;</span>;

<span class="hljs-meta">#[no_mangle]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">rust_main</span></span>() -&gt; ! {
    <span class="hljs-keyword">for</span> &amp;c <span class="hljs-keyword">in</span> HELLO {
        sbi::console_putchar(c <span class="hljs-keyword">as</span> usize);
    }
    <span class="hljs-keyword">loop</span> {}
}
</code></pre>
<p>&#x5219;&#x5C31;&#x4F1A;&#x62A5;&#x9519;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x7533;&#x8BF7;&#x5806;&#x6216;&#x8005;&#x662F;&#x9759;&#x6001;&#x6570;&#x636E;&#x7684;&#x7A7A;&#x95F4;&#x3002;</p>
<p><strong>&#x603B;&#x7ED3;</strong></p>
<p>&#x5173;&#x4E8E;kernel&#x4E2D;&#x7684;&#x8981;&#x505A;&#x7684;&#x6539;&#x52A8;&#x5E94;&#x8BE5;&#x5C31;&#x8FD9;&#x4E48;&#x591A;&#x3002;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x5982;&#x679C;&#x6309;&#x7167;rCore_tutorial&#x5230;<strong>&#x5B9E;&#x73B0;&#x683C;&#x5F0F;&#x5316;&#x8F93;&#x51FA;</strong>&#x8FD9;&#x4E00;&#x7AE0;&#x8282;&#xFF0C;&#x8F93;&#x51FA;&#x6548;&#x679C;&#x5E94;&#x8BE5;&#x662F;&#x548C;&#x6559;&#x7A0B;&#x4E2D;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x9610;&#x8FF0;&#x6709;&#x5173;bbl&#x8FD9;&#x4E00;bootloader&#x7684;&#x5206;&#x6790;&#xFF0C;&#x4EE5;&#x53CA;bbl&#x600E;&#x4E48;&#x548C;kerenl&#x7ED3;&#x5408;&#x8D77;&#x6765;&#xFF0C;&#x751F;&#x6210;&#x4E86;kernel.bin&#xFF0C;&#x6700;&#x7EC8;&#x6210;&#x529F;&#x8FD0;&#x884C;&#x5728;&#x4E86;&#x706B;&#x82D7;&#x4E0A;&#x3002;</p>
<h2 id="&#x9644;&#x5F55;">&#x9644;&#x5F55;</h2>
<p><a href="https://zhuanlan.zhihu.com/p/58405934?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=604058699816374272" target="_blank">bbl&#x542F;&#x52A8;&#x7684;32&#x4F4D;rcore</a></p>
<p><a href="https://github.com/LearningOS/rcore_step_by_step_old2" target="_blank">&#x5BF9;&#x5E94;&#x7684;&#x4ED3;&#x5E93;&#x5730;&#x5740;</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="2.火苗平台简介.html" class="navigation navigation-prev " aria-label="Previous page: 2.火苗平台简介">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="4.硬件分析.html" class="navigation navigation-next " aria-label="Next page: 4.硬件分析">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"3.启动流程分析","level":"1.4","depth":1,"next":{"title":"4.硬件分析","level":"1.5","depth":1,"path":"4.硬件分析.md","ref":"4.硬件分析.md","articles":[]},"previous":{"title":"2.火苗平台简介","level":"1.3","depth":1,"path":"2.火苗平台简介.md","ref":"2.火苗平台简介.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"3.启动流程分析.md","mtime":"2020-06-27T14:39:20.709Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-06-29T01:14:44.467Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

